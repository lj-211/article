# Large Pull Request
Large Pull Request，后文简写LPR。

当你看到别人提交一个LPR的时候，你的内心是不是抓狂的，甚至于想拒绝review这样的PR；所以通常来说，怎么优化你的PR是提交者的
责任。

所以后续的章节，我会着重说明下怎么避免去提交一个LRP，或者如果你的feature比较庞大，有什么办法去让别人更轻松的review你的代码。

当然在这之前有一些基本的原则，以下的讨论都默认基础要求都已经满足了:
1. 确保代码编译
2. 确认代码已经进行了GoLint和GoErrCheck的检查
3. 有完整的测试用例

## 如何创建一个LPR
如果你的feature的功能复杂度导致你不得不创建一个LRP，那做以下的事情可以让你的同事更轻松的review你的代码。
### 预防而不是补救
面对这种大而无法拆分的feature，最好的办法在技术方案实施之前，就找到你的partner，review你的方案，让最终的reviewer能清楚
你的设计和代码思路，这样他们最终在review的时候，就不会因为一个LPR导致没有一个全局的一个感受。

这一点我称之为预防，如果你是feature开发完成后，再找别人来介入，那可能方案本身就存在可讨论性，或者代码方案过于复杂，那
review的时候带来的问题就只能想办法补救了。

当然这一条只适合小团队内review，如果团队外部人员来交叉review，那估计他们也没心思参与你的方案设计。

### 精简你的commit日志
git的rebase命令一个强大的功能是重放你的个人分支，清爽你的提交记录；另一个强大功能就是整理压缩你的提交日志。
比如我们在开发的过程中，有连续的提交的revision的，但是其实这些信息是可以进行压缩的，通过git rebase -i r1 r2
把你的提交日志重新整理并且进行合理的压缩，有利于别人根绝你的提交log来进行review代码。

关于git rebase的用法参照另外一篇文章 TODO 增加文章链接

### 在你的PR中合理的去描述你的feature
在提交PR时，你需要详细的描述你的功能点，以及改动涉及的业务以及代码模块，负责review你的代码的同学就能总览下你的PR。
这一点是很有必要的，甚至于，你可以在描述中，建议怎么去review你的代码，让别人能够跟着你的思路检查你的代码。

## 尝试去拆分你的LPR
如果你的feature并不是非常严格要求必须保持完整，那其实可以把你的feature拆分成多个独立的分支，分布上线，这样你的PR就会
变成一个个的子问题。
### 拆分逻辑
在进行逻辑拆分时，可以按照以下几个原则进行拆分:

1. 再次细分feature进行拆分
2. 单个feature考虑进行模块拆分

对于一个feature无法拆分的部分，我们可以把feature进行拆分成有不同的小feature，比如feature a你需要创建两个api，那你可以
以单个api为单位(包含逻辑开发&测试用例)，分成多个PR。

第二点，考虑以模块进行拆分，比如数据层、业务层以及api层的代码，可以通过不同的PR去进行提交。

### 拆分办法
#### 利用开发流程进行拆分
```
master

  ^
  |
  |
  |                  ^   feature all
  |                  |
  |                  |
  |                  |
  |                  |
  |                  |
  |                  |
  |                  |
  |                  |
  |                  |
  |       feature b  |
  |           ^------> PR2
  |           |      |
  |           |      |
  |           |      |
  |           |      |
  |           |      |
  | feature a |      |
  |     ^----------->+ PR1
  |     |     |      |
  |     |     |      |
  |     |     |      |
  |     |     |      |
  +-----+-----+------+
  |
  |
  |
  |
  |
  +
```

以上面的git流程为例，feature all分支是最终你上线的代码。但是我们可以继续拆分成不同的feature a 和 feature b，在两个feature
开发完成后，分别提交两次PR到feature all分支，这样最终你拿来上线的feature all分支的代码都是review过的。这样PR1和PR2的逻辑
比较集中，而且review的代码量也会缩小。

当然也不仅限于此，也可以使用不同分支，分批上线。

#### 利用工具进行提交
使用git工具来多次提交pr，这里主要说的是git cherry-pick工具。
可以使用一个干净的分支，使用cherry-pick工具，把改动挑选出来，比如可以把涉及API A的commit挑选到一个独立分支，然后提交PR。
这样可以让reviewer每次检查的代码量级迅速缩小。

git cherry-pick的使用参照文章 TODO 这里增加文章链接

## 如何去review LPR
这里只有一条，你有权力拒绝一个LPR，记住这点就好了。
